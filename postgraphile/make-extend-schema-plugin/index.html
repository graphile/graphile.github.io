<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NNK4X8M');</script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous"/><link rel="preload" href="/component---src-layouts-index-js-ace7914a8fea060c15f6.js" as="script"/><link rel="preload" href="/component---src-templates-page-js-6df43615680729d980c3.js" as="script"/><link rel="preload" href="/path---postgraphile-make-extend-schema-plugin-3b61e6166bae4bbb3586.js" as="script"/><link rel="preload" href="/app-1b68f72edc9b9cfdf508.js" as="script"/><link rel="preload" href="/commons-e9c5ebe9f9d03df65cb6.js" as="script"/><title data-react-helmet="true">PostGraphile | graphile-utils makeExtendSchemaPlugin</title><meta data-react-helmet="true" name="description" content="Utilities to build powerful and performant GraphQL APIs"/><meta data-react-helmet="true" name="keywords" content="GraphQL, API, Graph, PostgreSQL, PostGraphile, PostGraphQL, Postgres-GraphQL, server, plugins, introspection, reflection"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=5.0"/><link rel="stylesheet" href="/styles.css?t=2018-11-02T11-05-45.811Z"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NNK4X8M" height="0" width="0" style="display:none;visibility:hidden;"></iframe></noscript><div id="___gatsby"><div tabindex="-1" data-reactroot="" data-reactid="1" data-react-checksum="427733071"><div class="template-page postgraphile" data-reactid="2"><!-- react-empty: 3 --><header class="header content absolute z-999 w-100" data-reactid="4"><nav class="navbar" data-reactid="5"><div class="container" data-reactid="6"><input type="checkbox" class="navbar-toggler input-reset" id="toggle" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" data-reactid="7"/><div class="nav-controls nested-list-reset " data-reactid="8"><div class="navbar-crosses" data-reactid="9"><span class="line line-1" data-reactid="10"> </span><span class="line line-2" data-reactid="11"> </span><span class="line line-3" data-reactid="12"> </span></div><ul class="navbar-nav flex w-100" data-reactid="13"><li class="navbar-item" data-reactid="14"><a class="nav-link " href="/" data-reactid="15"><span class="home-icon fas fa-home" data-reactid="16"></span><!-- react-text: 17 --> <!-- /react-text --><span class="home" data-reactid="18">Home</span></a></li><!-- react-empty: 19 --><!-- react-empty: 20 --><!-- react-empty: 21 --><li class="navbar-item" data-reactid="22"><a class="nav-link " href="/postgraphile/" data-reactid="23">Overview</a></li><li class="navbar-item" data-reactid="24"><a class="nav-link active" href="/postgraphile/introduction/" data-reactid="25">Documentation</a></li><li class="navbar-item" data-reactid="26"><a class="nav-link" href="https://www.patreon.com/benjie" target="patreon" data-reactid="27"><!-- react-text: 28 -->Sponsor<!-- /react-text --><!-- react-text: 29 --> <!-- /react-text --><span class="fas fa-external-link-square-alt" data-reactid="30"></span></a></li><!-- react-empty: 31 --><!-- react-empty: 32 --><!-- react-empty: 33 --><!-- react-empty: 34 --><!-- react-empty: 35 --><li class="navbar-item ml-auto navbar-item-right" data-reactid="36"><span class="searchbox-container" data-reactid="37"><input id="search-box" placeholder="Search" data-reactid="38"/><span class="fas fa-search searchbox-search" data-reactid="39"></span></span></li><li class="navbar-item navbar-item-right" data-reactid="40"><a class="nav-link " href="/support/" data-reactid="41"><span data-reactid="42"><span class="hide-when-small" data-reactid="43">Support and </span><!-- react-text: 44 -->Services<!-- /react-text --></span></a></li><li class="navbar-item navbar-item-right" data-reactid="45"><a class="nav-link nav-github-link flex items-center" href="https://github.com/graphile/postgraphile" data-reactid="46"><span class="f3 fab fa-github" data-reactid="47"></span><!-- react-text: 48 --> <!-- /react-text --><span class="github" data-reactid="49"><!-- react-text: 50 -->Github<!-- /react-text --><!-- react-text: 51 --> <!-- /react-text --><span class="fas fa-external-link-square-alt" data-reactid="52"></span></span></a></li></ul></div></div></nav></header><div class="page-content" data-reactid="53"><section data-reactid="54"><div class="container" data-reactid="55"><div class="row between-xs" data-reactid="56"><aside class="sidebar col-xs-12 col-md-3 last-xs mt3" data-reactid="57"><section data-reactid="58"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="59"><span data-reactid="60">Overview</span></h4><div class="nested-list-reset" data-reactid="61"><ul class="page-list nav flex-column mb5" data-reactid="62"><li class="f6 lh-copy pv1" data-reactid="63"><a class="nav-link " href="/postgraphile/introduction/" data-reactid="64"><span data-reactid="65">Introduction</span></a></li><li class="f6 lh-copy pv1" data-reactid="66"><a class="nav-link " href="/postgraphile/examples/" data-reactid="67"><span data-reactid="68"><strong>Example Gallery</strong></span></a></li><li class="f6 lh-copy pv1" data-reactid="69"><a class="nav-link " href="/postgraphile/usage/" data-reactid="70"><span data-reactid="71">Usage</span></a><ul class="page-list nav flex-column null" data-reactid="72"><li class="f6 lh-copy pv1" data-reactid="73"><a class="nav-link " href="/postgraphile/usage-cli/" data-reactid="74"><span data-reactid="75">CLI Usage</span></a></li><li class="f6 lh-copy pv1" data-reactid="76"><a class="nav-link " href="/postgraphile/usage-library/" data-reactid="77"><span data-reactid="78">Library Usage</span></a></li><li class="f6 lh-copy pv1" data-reactid="79"><a class="nav-link " href="/postgraphile/usage-schema/" data-reactid="80"><span data-reactid="81">Schema-only Usage</span></a></li></ul></li><li class="f6 lh-copy pv1" data-reactid="82"><a class="nav-link " href="/postgraphile/performance/" data-reactid="83"><span data-reactid="84">Performance</span></a></li><li class="f6 lh-copy pv1" data-reactid="85"><a class="nav-link " href="/postgraphile/requirements/" data-reactid="86"><span data-reactid="87">Requirements</span></a></li></ul></div></section><section data-reactid="88"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="89"><span data-reactid="90">Operation</span></h4><div class="nested-list-reset" data-reactid="91"><ul class="page-list nav flex-column mb5" data-reactid="92"><li class="f6 lh-copy pv1" data-reactid="93"><a class="nav-link " href="/postgraphile/quick-start-guide/" data-reactid="94"><span data-reactid="95">Quick Start Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="96"><a class="nav-link " href="/postgraphile/namespaces/" data-reactid="97"><span data-reactid="98">Namespaces</span></a></li><li class="f6 lh-copy pv1" data-reactid="99"><a class="nav-link " href="/postgraphile/inflection/" data-reactid="100"><span data-reactid="101">Inflection</span></a></li><li class="f6 lh-copy pv1" data-reactid="102"><a class="nav-link " href="/postgraphile/tables/" data-reactid="103"><span data-reactid="104">Tables</span></a><ul class="page-list nav flex-column null" data-reactid="105"><li class="f6 lh-copy pv1" data-reactid="106"><a class="nav-link " href="/postgraphile/relations/" data-reactid="107"><span data-reactid="108">Relations</span></a></li><li class="f6 lh-copy pv1" data-reactid="109"><a class="nav-link " href="/postgraphile/connections/" data-reactid="110"><span data-reactid="111">Connections</span></a></li><li class="f6 lh-copy pv1" data-reactid="112"><a class="nav-link " href="/postgraphile/filtering/" data-reactid="113"><span data-reactid="114">Filtering</span></a></li><li class="f6 lh-copy pv1" data-reactid="115"><a class="nav-link " href="/postgraphile/crud-mutations/" data-reactid="116"><span data-reactid="117">CRUD Mutations</span></a></li><li class="f6 lh-copy pv1" data-reactid="118"><a class="nav-link " href="/postgraphile/node-id/" data-reactid="119"><span data-reactid="120">nodeId / id</span></a></li></ul></li><li class="f6 lh-copy pv1" data-reactid="121"><a class="nav-link " href="/postgraphile/functions/" data-reactid="122"><span data-reactid="123">Functions</span></a><ul class="page-list nav flex-column null" data-reactid="124"><li class="f6 lh-copy pv1" data-reactid="125"><a class="nav-link " href="/postgraphile/computed-columns/" data-reactid="126"><span data-reactid="127">Computed Columns</span></a></li><li class="f6 lh-copy pv1" data-reactid="128"><a class="nav-link " href="/postgraphile/custom-queries/" data-reactid="129"><span data-reactid="130">Custom Queries</span></a></li><li class="f6 lh-copy pv1" data-reactid="131"><a class="nav-link " href="/postgraphile/custom-mutations/" data-reactid="132"><span data-reactid="133">Custom Mutations</span></a></li><li class="f6 lh-copy pv1" data-reactid="134"><a class="nav-link " href="/postgraphile/function-restrictions/" data-reactid="135"><span data-reactid="136">Function Restrictions</span></a></li><li class="f6 lh-copy pv1" data-reactid="137"><a class="nav-link " href="/postgraphile/function-gallery/" data-reactid="138"><span data-reactid="139"><strong>Function Gallery</strong></span></a></li></ul></li><li class="f6 lh-copy pv1" data-reactid="140"><a class="nav-link " href="/postgraphile/postgresql-indexes/" data-reactid="141"><span data-reactid="142">PostgreSQL Indexes</span></a></li><li class="f6 lh-copy pv1" data-reactid="143"><a class="nav-link " href="/postgraphile/security/" data-reactid="144"><span data-reactid="145">Security</span></a></li><li class="f6 lh-copy pv1" data-reactid="146"><a class="nav-link " href="/postgraphile/subscriptions/" data-reactid="147"><span data-reactid="148">Subscriptions</span></a></li><li class="f6 lh-copy pv1" data-reactid="149"><a class="nav-link " href="/postgraphile/reserved-keywords/" data-reactid="150"><span data-reactid="151">Reserved Keywords</span></a></li><li class="f6 lh-copy pv1" data-reactid="152"><a class="nav-link " href="/postgraphile/debugging/" data-reactid="153"><span data-reactid="154">Debugging</span></a></li></ul></div></section><section data-reactid="155"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="156"><span data-reactid="157">Customising</span></h4><div class="nested-list-reset" data-reactid="158"><ul class="page-list nav flex-column mb5" data-reactid="159"><li class="f6 lh-copy pv1" data-reactid="160"><a class="nav-link " href="/postgraphile/smart-comments/" data-reactid="161"><span data-reactid="162">Smart Comments</span></a></li><li class="f6 lh-copy pv1" data-reactid="163"><a class="nav-link " href="/postgraphile/extending/" data-reactid="164"><span data-reactid="165">Schema Plugins</span></a><ul class="page-list nav flex-column null" data-reactid="166"><li class="f6 lh-copy pv1" data-reactid="167"><a class="nav-link active" href="/postgraphile/make-extend-schema-plugin/" data-reactid="168"><span data-reactid="169">makeExtendSchemaPlugin</span></a></li><li class="f6 lh-copy pv1" data-reactid="170"><a class="nav-link " href="/postgraphile/make-add-inflectors-plugin/" data-reactid="171"><span data-reactid="172">makeAddInflectorsPlugin</span></a></li><li class="f6 lh-copy pv1" data-reactid="173"><a class="nav-link " href="/postgraphile/extending-raw/" data-reactid="174"><span data-reactid="175">Graphile Engine</span></a></li><li class="f6 lh-copy pv1" data-reactid="176"><a class="nav-link " href="/postgraphile/plugin-gallery/" data-reactid="177"><span data-reactid="178"><strong>Plugin Gallery</strong></span></a></li></ul></li><li class="f6 lh-copy pv1" data-reactid="179"><a class="nav-link " href="/postgraphile/plugins/" data-reactid="180"><span data-reactid="181">Server Plugins</span></a></li></ul></div></section><section data-reactid="182"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="183"><span data-reactid="184">Guides</span></h4><div class="nested-list-reset" data-reactid="185"><ul class="page-list nav flex-column mb5" data-reactid="186"><li class="f6 lh-copy pv1" data-reactid="187"><a class="nav-link " href="/postgraphile/evaluating/" data-reactid="188"><span data-reactid="189">Evaluating for your Project</span></a></li><li class="f6 lh-copy pv1" data-reactid="190"><a class="nav-link " href="/postgraphile/postgresql-schema-design/" data-reactid="191"><span data-reactid="192">PostgreSQL Schema Design</span></a></li><li class="f6 lh-copy pv1" data-reactid="193"><a class="nav-link " href="/postgraphile/production/" data-reactid="194"><span data-reactid="195">Production Considerations</span></a></li><li class="f6 lh-copy pv1" data-reactid="196"><a class="nav-link " href="/postgraphile/jwt-guide/" data-reactid="197"><span data-reactid="198">PostGraphile JWT Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="199"><a class="nav-link " href="/postgraphile/jwk-verification/" data-reactid="200"><span data-reactid="201">JWK Verification (e.g. Auth0)</span></a></li><li class="f6 lh-copy pv1" data-reactid="202"><a class="nav-link " href="/postgraphile/default-role/" data-reactid="203"><span data-reactid="204">The Default Role</span></a></li><li class="f6 lh-copy pv1" data-reactid="205"><a class="nav-link " href="/postgraphile/v4-new-features/" data-reactid="206"><span data-reactid="207">v4 Feature Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="208"><a class="nav-link " href="/postgraphile/v3-migration/" data-reactid="209"><span data-reactid="210">v3 ‚Üí v4 Migration Guide</span></a></li><li class="f6 lh-copy pv1" data-reactid="211"><a class="nav-link " href="/postgraphile/testing-jest/" data-reactid="212"><span data-reactid="213">Testing with Jest</span></a></li></ul></div></section><section data-reactid="214"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="215"><span data-reactid="216">Community</span></h4><div class="nested-list-reset" data-reactid="217"><ul class="page-list nav flex-column mb5" data-reactid="218"><li class="f6 lh-copy pv1" data-reactid="219"><a class="nav-link " href="/postgraphile/community-plugins/" data-reactid="220"><span data-reactid="221">Community Plugins</span></a></li><li class="f6 lh-copy pv1" data-reactid="222"><a class="nav-link " href="/postgraphile/community-chat/" data-reactid="223"><span data-reactid="224">Community Chat</span></a></li><li class="f6 lh-copy pv1" data-reactid="225"><a class="nav-link " href="/postgraphile/code-of-conduct/" data-reactid="226"><span data-reactid="227">Code of Conduct</span></a></li></ul></div></section><section data-reactid="228"><h4 class="f6 ttu fw6 mt0 mb3 bb pb2" data-reactid="229"><span data-reactid="230">FAQ</span></h4><div class="nested-list-reset" data-reactid="231"><ul class="page-list nav flex-column mb5" data-reactid="232"><li class="f6 lh-copy pv1" data-reactid="233"><a class="nav-link " href="/postgraphile/introspection/" data-reactid="234"><span data-reactid="235">Introspection?</span></a></li><li class="f6 lh-copy pv1" data-reactid="236"><a class="nav-link " href="/postgraphile/why-nullable/" data-reactid="237"><span data-reactid="238">Why is it nullable?</span></a></li><li class="f6 lh-copy pv1" data-reactid="239"><a class="nav-link " href="/postgraphile/versioning-policy/" data-reactid="240"><span data-reactid="241">Versioning policy?</span></a></li></ul></div></section></aside><div class="col-xs-12 col-md-9 first-xs main-content" data-reactid="242"><div class="row" data-reactid="243"><div class="col-xs-12" style="width:100%;" data-reactid="244"><div class="edit-this-page" style="display:;" data-reactid="245"><a href="https://github.com/graphile/graphile.github.io/edit/develop/src/pages/postgraphile/make-extend-schema-plugin.md" data-reactid="246">üìù Suggest improvements to this page</a></div><div data-reactid="247"><h2 id="makeextendschemaplugin-graphile-utils"><a href="#makeextendschemaplugin-graphile-utils" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>makeExtendSchemaPlugin (graphile-utils)</h2>
<p><strong>NOTE: this documentation applies to PostGraphile v4.1.0+</strong></p>
<p>The <code class="language-text">graphile-utils</code> module contains some helpers for extending your
PostGraphile (or Graphile Engine) GraphQL schema without having to understand
the complex plugin system.</p>
<p>The main one you'll care about to start with is <code class="language-text">makeExtendSchemaPlugin</code>.</p>
<p>Using <code class="language-text">makeExtendSchemaPlugin</code> you can write a plugin that will merge additional
GraphQL types and resolvers into your schema using a similar syntax to
<code class="language-text">graphql-tools</code>. You just need to provide the <code class="language-text">typeDefs</code> and <code class="language-text">resolvers</code> to
use. Your plugin will likely take a shape like this:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>
  makeExtendSchemaPlugin<span class="token punctuation">,</span>
  gql<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'graphile-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MySchemaExtensionPlugin <span class="token operator">=</span>
  <span class="token function">makeExtendSchemaPlugin</span><span class="token punctuation">(</span>
    build <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      typeDefs<span class="token punctuation">:</span> gql<span class="token template-string"><span class="token string">`...`</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">      resolvers<span class="token punctuation">:</span> <span class="token operator">...</span>
</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MySchemaExtensionPlugin<span class="token punctuation">;</span></code></pre>
      </div>
<p>And would be added to your PostGraphile instance via</p>
<ul>
<li>CLI: <code class="language-text">--append-plugins `pwd`/MySchemaExtensionPlugin.js</code></li>
<li>Library: <code class="language-text">appendPlugins: [require(&#39;./MySchemaExtensionPlugin&#39;)]</code></li>
</ul>
<p>The <code class="language-text">build</code> argument to the makeExtendSchemaPlugin callback contains lots of
information and helpers defined by various plugins, most importantly it
includes the introspection results (<code class="language-text">build.pgIntrospectionResultsByKind</code>),
inflection functions (<code class="language-text">build.inflection</code>), and SQL helper (<code class="language-text">build.pgSql</code>, which
is just an instance of <a href="https://www.npmjs.com/package/pg-sql2">pg-sql2</a>).</p>
<p>The callback should return an object with two keys:</p>
<ul>
<li><code class="language-text">typeDefs</code>: a graphql AST generated with the <code class="language-text">gql</code> helper from
<code class="language-text">graphile-utils</code> (note this is NOT from the <code class="language-text">graphql-tag</code> library, ours works
in a slightly different way).</li>
<li><code class="language-text">resolvers</code>: an object that's keyed by the GraphQL type names of types
defined (or extended) in <code class="language-text">typeDefs</code>, the values of which are objects keyed by
the field names with values that are resolver functions.</li>
</ul>
<p>For a larger example of how typeDefs and resolvers work, have a look at the
<a href="https://www.apollographql.com/docs/graphql-tools/generate-schema.html">graphql-tools
docs</a> -
ours work in a similar way.</p>
<p>Note that the resolve functions defined in <code class="language-text">resolvers</code> will be sent the
standard 4 GraphQL resolve arguments (<code class="language-text">parent</code>, <code class="language-text">args</code>, <code class="language-text">context</code>,
<code class="language-text">resolveInfo</code>); but in addition they will be passed a 5th argument that
contains graphile-specific helpers.</p>
<h3 id="reading-database-column-values"><a href="#reading-database-column-values" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reading database column values</h3>
<p>When extending a schema, it's often because you want to expose data from Node.js
that would be difficult too difficult (or impossible) to access from PostgreSQL.
When defining a field on an existing table-backed type defined by PostGraphile,
it's useful to access data from the underlying table in the resolver.</p>
<p>To do this you can use the <code class="language-text">@requires(columns: [‚Ä¶])</code> field directive to declare
the data dependencies of your resolver. This guarantees that when the resolver
is executed, the data is immediately available.</p>
<p>Here's an example to illustrate.</p>
<p>In the database you have a <code class="language-text">product</code> table (imagine an online store), that
PostGraphile will include in the GraphQL schema by creating a type <code class="language-text">Product</code>
with fields <code class="language-text">id</code>, <code class="language-text">name</code>, <code class="language-text">price_in_us_cents</code>.</p>
<div class="gatsby-highlight">
      <pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> product <span class="token punctuation">(</span>
  id uuid <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  price_in_us_cents <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>This would result in the following GraphQL type:</p>
<div class="gatsby-highlight">
      <pre class="language-graphql"><code class="language-graphql">type Product <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> UUID<span class="token operator">!</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">priceInUsCents</span><span class="token punctuation">:</span> Int<span class="token operator">!</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>However imagine you're selling internationally, and you want to expose the price
in other currencies directly from the <code class="language-text">Product</code> type itself. This kind of
functionality is trivial to perform in Node.js (e.g. by making a REST call to a
foreign exchange service over the internet) but might be a struggle from with
PostgreSQL.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> postgraphile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"postgraphile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token punctuation">{</span> makeExtendSchemaPlugin<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"graphile-utils"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token punctuation">{</span> convertUsdToAud <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ficticious-npm-library"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span>
<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> MyForeignExchangePlugin <span class="token operator">=</span> <span class="token function">makeExtendSchemaPlugin</span><span class="token punctuation">(</span>build <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> pgSql<span class="token punctuation">:</span> sql <span class="token punctuation">}</span> <span class="token operator">=</span> build<span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">    typeDefs<span class="token punctuation">:</span> gql<span class="token template-string"><span class="token string">`
</span><span class="gatsby-highlight-code-line">      extend type Product {
</span><span class="gatsby-highlight-code-line">        priceInAuCents: Int! @requires(columns: ["price_in_us_cents"])
</span><span class="gatsby-highlight-code-line">      }
</span><span class="gatsby-highlight-code-line">    `</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">    resolvers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">      Product<span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">        priceInAuCents<span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">          product
</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">          <span class="token comment">// Note that the columns are converted to fields, so the case changes</span>
</span><span class="gatsby-highlight-code-line">          <span class="token comment">// from `price_in_us_cents` to `priceInUsCents`</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">const</span> <span class="token punctuation">{</span> priceInUsCents <span class="token punctuation">}</span> <span class="token operator">=</span> product<span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">convertUsdToAud</span><span class="token punctuation">(</span>priceInUsCents<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">postgraphile</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"app_public"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    graphiql<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">    appendPlugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>MyForeignExchangePlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3030</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<h3 id="the-selectgraphqlresultfromtable-helper"><a href="#the-selectgraphqlresultfromtable-helper" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The <code class="language-text">selectGraphQLResultFromTable</code> helper</h3>
<p>The <code class="language-text">selectGraphQLResultFromTable</code> function is vital if you want to return data
from the database from your new GraphQL field. It is responsible for hooking into
the query look-ahead features of <code class="language-text">graphile-build</code> to inspect the incoming GraphQL
query and pull down the relevant data from the database
(including nested relations). You are then expected to return the result of
this fetch via your resolver. You can use the <code class="language-text">sqlBuilder</code> object to customise
the generated query, changing the order, adding <code class="language-text">where</code> clauses, <code class="language-text">limit</code>s, etc.
Note that if you are not returning a record type directly (for example you're
returning a mutation payload, or a connection interface), you should use the
<code class="language-text">@pgField</code> directive on the fields of your returned type so that the Look Ahead
feature continues to work.</p>
<p>The <code class="language-text">sqlBuilder</code> uses an SQL AST constructed via
<a href="https://github.com/graphile/pg-sql2/blob/master/README.md"><code class="language-text">pg-sql2</code> methods</a>
to dynamically create powerful SQL queries without risking SQL injection
attacks. The <code class="language-text">sqlBuilder</code> has a number of methods which affect the query which
will be generated. The main ones you're likely to want are:</p>
<ul>
<li><code class="language-text">where(sqlFragment)</code>; e.g. <code class="language-text">sqlBuilder.where(build.pgSql.fragment`is_admin is true`)</code></li>
<li><code class="language-text">orderBy(() =&gt; sqlFragment, ascending)</code>; e.g. <code class="language-text">sqlBuilder.orderBy(() =&gt; build.pgSql.fragment`created_at`, false)</code></li>
<li><code class="language-text">limit(number)</code>; e.g. <code class="language-text">sqlBuilder.limit(1)</code></li>
<li><code class="language-text">offset(number)</code>; e.g. <code class="language-text">sqlBuilder.offset(1)</code></li>
<li><code class="language-text">select(() =&gt; sqlFragment, alias)</code>; e.g. <code class="language-text">sqlBuilder.select(() =&gt; build.pgSql.fragment`gen_random_uuid()`, &#39;__my_random_uuid&#39;)</code> - it's advised to start your alias with two underscores to prevent it clashing with any potential columns exposed as GraphQL fields.</li>
</ul>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> postgraphile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"postgraphile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> makeExtendSchemaPlugin<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"graphile-utils"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> MyRandomUserPlugin <span class="token operator">=</span> <span class="token function">makeExtendSchemaPlugin</span><span class="token punctuation">(</span>build <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> pgSql<span class="token punctuation">:</span> sql <span class="token punctuation">}</span> <span class="token operator">=</span> build<span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">    typeDefs<span class="token punctuation">:</span> gql<span class="token template-string"><span class="token string">`
</span><span class="gatsby-highlight-code-line">      extend type Query {
</span><span class="gatsby-highlight-code-line">        randomUser: User
</span><span class="gatsby-highlight-code-line">      }
</span><span class="gatsby-highlight-code-line">    `</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">    resolvers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">      Query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">        randomUser<span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">          _query<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          args<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          context<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          resolveInfo<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          <span class="token punctuation">{</span> selectGraphQLResultFromTable <span class="token punctuation">}</span>
</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">          <span class="token comment">// Remember: selectGraphQLResultFromTable is where the PostGraphile</span>
</span><span class="gatsby-highlight-code-line">          <span class="token comment">// look-ahead magic happens!</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">const</span> rows <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">selectGraphQLResultFromTable</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">            sql<span class="token punctuation">.</span>fragment<span class="token template-string"><span class="token string">`app_public.users`</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">(</span>tableAlias<span class="token punctuation">,</span> sqlBuilder<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">              sqlBuilder<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>sql<span class="token punctuation">.</span>fragment<span class="token template-string"><span class="token string">`random()`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">              sqlBuilder<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">}</span>
</span><span class="gatsby-highlight-code-line">          <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">return</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">postgraphile</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"app_public"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    graphiql<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    appendPlugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>MyRandomUserPlugin<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3030</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>The above is a simple and fairly pointless example which would have been better
served by a <a href="/postgraphile/custom-queries/#custom-query-sql-procedures">Custom Query SQL
Procedure</a>; however
you can also use this system to define mutations or to call out to external
services. For example, you might want to add a custom <code class="language-text">registerUser</code> mutation
which inserts the new user into the database and also sends them an email:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> MyRegisterUserMutationPlugin <span class="token operator">=</span>
<span class="token function">makeExtendSchemaPlugin</span><span class="token punctuation">(</span>build <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pgSql<span class="token punctuation">:</span> sql <span class="token punctuation">}</span> <span class="token operator">=</span> build<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    typeDefs<span class="token punctuation">:</span> gql<span class="token template-string"><span class="token string">`
      input RegisterUserInput {
        name: String!
        email: String!
        bio: String
      }

      type RegisterUserPayload {
        user: User @pgField
        query: Query
      }

<span class="gatsby-highlight-code-line">      extend type Mutation {
</span>        registerUser(input: RegisterUserInput!):
          RegisterUserPayload
      }
    `</span></span><span class="token punctuation">,</span>
    resolvers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      Mutation<span class="token punctuation">:</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">        registerUser<span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">          _query<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          args<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          context<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          resolveInfo<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">          <span class="token punctuation">{</span> selectGraphQLResultFromTable <span class="token punctuation">}</span>
</span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">const</span> <span class="token punctuation">{</span> pgClient <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">          <span class="token comment">// Start a sub-transaction</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">await</span> pgClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"SAVEPOINT graphql_mutation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">          <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// Our custom logic to register the user:</span>
</span><span class="gatsby-highlight-code-line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> rows<span class="token punctuation">:</span> <span class="token punctuation">[</span>user<span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> pgClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">              <span class="token template-string"><span class="token string">`INSERT INTO app_public.users(
</span><span class="gatsby-highlight-code-line">                name, email, bio
</span><span class="gatsby-highlight-code-line">              ) VALUES ($1, $2, $3)
</span><span class="gatsby-highlight-code-line">              RETURNING *`</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">              <span class="token punctuation">[</span>
</span><span class="gatsby-highlight-code-line">                args<span class="token punctuation">.</span>input<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">                args<span class="token punctuation">.</span>input<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">                args<span class="token punctuation">.</span>input<span class="token punctuation">.</span>bio<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">              <span class="token punctuation">]</span>
</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// Now we fetch the result that the GraphQL</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// client requested, using the new user</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// account as the source of the data. You</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// should always use</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// `selectGraphQLResultFromTable` if you</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// return database data from your custom</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// field.</span>
</span><span class="gatsby-highlight-code-line">            <span class="token keyword">const</span> <span class="token punctuation">[</span>row<span class="token punctuation">]</span> <span class="token operator">=</span>
</span><span class="gatsby-highlight-code-line">              <span class="token keyword">await</span> <span class="token function">selectGraphQLResultFromTable</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">                sql<span class="token punctuation">.</span>fragment<span class="token template-string"><span class="token string">`app_public.users`</span></span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">                <span class="token punctuation">(</span>tableAlias<span class="token punctuation">,</span> sqlBuilder<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">                  sqlBuilder<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">                    sql<span class="token punctuation">.</span>fragment<span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tableAlias<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.id = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>
</span><span class="gatsby-highlight-code-line">                      sql<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
</span><span class="gatsby-highlight-code-line">                    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
</span><span class="gatsby-highlight-code-line">                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">                <span class="token punctuation">}</span>
</span><span class="gatsby-highlight-code-line">              <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// Finally we send the email. If this</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// fails then we'll catch the error</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// and roll back the transaction, and</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// it will be as if the user never</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// registered</span>
</span><span class="gatsby-highlight-code-line">            <span class="token keyword">await</span> <span class="token function">mockSendEmail</span><span class="token punctuation">(</span>
</span><span class="gatsby-highlight-code-line">              args<span class="token punctuation">.</span>input<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">              <span class="token string">"Welcome to my site"</span><span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">              <span class="token template-string"><span class="token string">`You're user </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - `</span></span> <span class="token operator">+</span>
</span><span class="gatsby-highlight-code-line">                <span class="token template-string"><span class="token string">`thanks for being awesome`</span></span>
</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// Success! Write the user to the database.</span>
</span><span class="gatsby-highlight-code-line">            <span class="token keyword">await</span> pgClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"RELEASE SAVEPOINT graphql_mutation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="gatsby-highlight-code-line">
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// If the return type is a database record type, like User, then</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// you would return `row` directly. However if it's an indirect</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// interface such as a connection or mutation payload then</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// you return an object with a `data` property. You can add</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// additional properties too, that can be used by other fields</span>
</span><span class="gatsby-highlight-code-line">            <span class="token comment">// on the result type.</span>
</span><span class="gatsby-highlight-code-line">            <span class="token keyword">return</span> <span class="token punctuation">{</span>
</span><span class="gatsby-highlight-code-line">              data<span class="token punctuation">:</span> row<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">              query<span class="token punctuation">:</span> build<span class="token punctuation">.</span>$$isQuery<span class="token punctuation">,</span>
</span><span class="gatsby-highlight-code-line">            <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span>          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Oh noes! If at first you don't succeed,</span>
            <span class="token comment">// destroy all evidence you ever tried.</span>
            <span class="token keyword">await</span> pgClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"ROLLBACK TO SAVEPOINT graphql_mutation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>Note that the <code class="language-text">@pgField</code> directive here is necessary for PostGraphile to "look
ahead" and determine what to request from the database.</p></div></div><br data-reactid="248"/><br data-reactid="249"/><div class="col-xs-12 mt3 mb5" data-reactid="250"><div class="row between-xs" data-reactid="251"><div class="col-xs-6" data-reactid="252"></div><div class="col-xs-6 tr" data-reactid="253"></div></div></div></div></div></div></div></section><section class="mailinglist" data-reactid="254"><div class="container" data-reactid="255"><div class="row" data-reactid="256"><div class="col-xs-12" data-reactid="257"><div class="hero-block" data-reactid="258"><h3 data-reactid="259"><!-- react-text: 260 -->Questions, comments or feedback?<!-- /react-text --><br data-reactid="261"/><!-- react-text: 262 -->Email<!-- /react-text --><!-- react-text: 263 --> <!-- /react-text --><a href="mailto:info@graphile.org?subject=Documentation%20question/comment/feedback:)" data-reactid="264">info@graphile.org</a></h3><form action="//graphile.us16.list-manage.com/subscribe/post?u=d103f710cf00a9273b55e8e9b&amp;id=c3a9eb5c4e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="" data-reactid="265"><div id="mc_embed_signup_scroll" class="center hero-block" data-reactid="266"><p data-reactid="267">Keep up to date on Graphile and PostGraphile features/changes. Subscribe to our occasional announcements newsletter:</p><div class="mc-field-group form-inline justify-content-center" data-reactid="268"><div class="form-group" data-reactid="269"><div class="mb2" data-reactid="270"><label class="label--small" for="mce-EMAIL" data-reactid="271">Email address:</label></div><input type="email" autocapitalize="off" autocomplete="off" autocorrect="off" class="input-text mb0-ns mb1" id="mce-EMAIL" name="EMAIL" spellcheck="false" value="" data-reactid="272"/><div style="position:absolute;left:-5000px;" aria-hidden="true" data-reactid="273"><input type="text" name="b_d103f710cf00a9273b55e8e9b_c3a9eb5c4e" tabindex="-1" value="" data-reactid="274"/></div><input type="submit" class="button--solid" id="mc-embedded-subscribe" name="subscribe" value="Subscribe" data-reactid="275"/></div><div id="mce-responses" class="clear" data-reactid="276"><div class="response" id="mce-error-response" style="display:none;" data-reactid="277"></div><div class="response" id="mce-success-response" style="display:none;" data-reactid="278"></div></div></div></div></form></div></div></div></div></section></div><footer class="bg-white pv5 bt b--black f6 lh-copy" data-reactid="279"><div class="container" data-reactid="280"><div class="row" data-reactid="281"><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="282"><h6 data-reactid="283">PostGraphile</h6><ul data-reactid="284"><li data-reactid="285"><a href="/postgraphile/introduction/" data-reactid="286">Introduction</a></li><li data-reactid="287"><a href="/postgraphile/security/" data-reactid="288">Security</a></li><li data-reactid="289"><a href="/postgraphile/extending/" data-reactid="290">Extending</a></li></ul></div><div class="col-xs-12 col-md-2 nested-list-reset " data-reactid="291"><h6 data-reactid="292">Graphile Engine</h6><ul data-reactid="293"><li data-reactid="294"><a href="/graphile-build/" data-reactid="295">About</a></li><li data-reactid="296"><a href="/graphile-build/getting-started/" data-reactid="297">Getting Started</a></li><li data-reactid="298"><a href="/graphile-build/plugins/" data-reactid="299">Plugins</a></li></ul></div><div class="col-xs-12 col-md-2 nested-list-reset" data-reactid="300"><h6 data-reactid="301">Resources</h6><ul data-reactid="302"><li data-reactid="303"><a href="/news/" data-reactid="304"><i class="fas fa-bullhorn" data-reactid="305"></i><!-- react-text: 306 --> News<!-- /react-text --></a></li><li data-reactid="307"><a href="https://github.com/graphile" data-reactid="308"><i class="fab fa-github" data-reactid="309"></i><!-- react-text: 310 --> GitHub<!-- /react-text --></a></li><li data-reactid="311"><a href="http://discord.gg/graphile" data-reactid="312"><i class="fab fa-discord" data-reactid="313"></i><!-- react-text: 314 --> Chat (discord)<!-- /react-text --></a></li><li data-reactid="315"><a href="https://twitter.com/benjie" data-reactid="316"><i class="fab fa-twitter" data-reactid="317"></i><!-- react-text: 318 --> Twitter<!-- /react-text --></a></li><li data-reactid="319"><a href="/news/press-kit/" data-reactid="320"><i class="fas fa-file-archive" data-reactid="321"></i><!-- react-text: 322 --> Logos/etc<!-- /react-text --></a></li></ul></div><div class="col-xs-12 col-md-offset-1 col-md-5" data-reactid="323"><h6 data-reactid="324">About</h6><!-- react-text: 325 -->PostGraphile and Graphile Build are Open Source Software, developed and maintained by <!-- /react-text --><a href="https://twitter.com/benjie" data-reactid="326">@Benjie</a><!-- react-text: 327 --> <!-- /react-text --><!-- react-text: 328 -->with the help of the community.<!-- /react-text --><br data-reactid="329"/><br data-reactid="330"/><!-- react-text: 331 -->You can support the projects via<!-- /react-text --><!-- react-text: 332 --> <!-- /react-text --><a href="https://www.patreon.com/benjie" target="_blank" rel="noopener noreferrer" data-reactid="333">Patreon</a><!-- react-text: 334 -->, by <!-- /react-text --><a href="/postgraphile/pricing/" data-reactid="335">going Pro</a><!-- react-text: 336 -->, or by paying for <!-- /react-text --><a href="/support/" data-reactid="337">Professional Services</a><!-- react-text: 338 -->. Your support is gratefully received üôè<!-- /react-text --><br data-reactid="339"/><br data-reactid="340"/><!-- react-text: 341 -->This site is copyright ¬© Benjie Gillam <!-- /react-text --><!-- react-text: 342 -->2018<!-- /react-text --><!-- react-text: 343 -->. Design and logos copyright ¬© Benjie Gillam and Jof Arnold<!-- /react-text --><!-- react-text: 344 --> <!-- /react-text --><!-- react-text: 345 -->2018<!-- /react-text --><!-- react-text: 346 -->.<!-- /react-text --><br data-reactid="347"/><br data-reactid="348"/><!-- react-text: 349 -->Corrections and contributions to this website are gratefully received via<!-- /react-text --><!-- react-text: 350 --> <!-- /react-text --><a href="https://github.com/graphile/graphile.github.io" data-reactid="351">its GitHub repository</a><!-- react-text: 352 -->.<!-- /react-text --><br data-reactid="353"/><br data-reactid="354"/><!-- react-text: 355 -->PostGraphile was <!-- /react-text --><a href="/history/" data-reactid="356">originally authored</a><!-- react-text: 357 --> as PostGraphQL by<!-- /react-text --><!-- react-text: 358 --> <!-- /react-text --><a href="https://twitter.com/calebmer" data-reactid="359">Caleb Meredith</a><!-- react-text: 360 -->.<!-- /react-text --></div></div></div></footer></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-1b68f72edc9b9cfdf508.js","96961042003272":"component---src-templates-page-js-6df43615680729d980c3.js","59784799166159":"component---src-templates-marketing-js-1db22aaf97ede6309720.js","60335399758886":"path----557518bd178906f8d58a.js","45788430371641":"path---history-3f3033247171c9006afa.js","192423053311925":"path---graphile-build-pg-security-e91a57eca10330c6d1fc.js","194808618595402":"path---graphile-build-pg-settings-f835ccda90b309dde07b.js","128602041518144":"path---graphile-build-all-hooks-84cb4e425069c9a44895.js","64023390553510":"path---graphile-build-build-object-174fa3fb7d5841c78592.js","69504633912515":"path---graphile-build-context-object-8bd64b0eef0164f5b736.js","125892818282768":"path---graphile-build-default-plugins-9a1ce80d6014362ec1af.js","109947277077173":"path---graphile-build-getting-started-32f9482f9554603db1c5.js","16210746157911":"path---graphile-build-graphile-build-23ce166131fcd0a41d65.js","57552969484094":"path---graphile-build-hooks-97a48654c88f53b38d36.js","109627700230002":"path---graphile-build-f41a9655e0ee6494c60a.js","36474596372704":"path---graphile-build-omitting-plugins-83ee2d18a48733326a96.js","276285638780302":"path---graphile-build-plugin-options-af1ccb64fe05ffc8a116.js","136546493962690":"path---graphile-build-plugins-3cef4c05f4116f4004fd.js","277477532944301":"path---graphile-build-schema-builder-943443ac98516a3fad3d.js","208863975630277":"path---news-d5c233043ef1ff664a37.js","143510993521902":"path---news-postgraphile-version-4-172d83834ed2cf1d7f41.js","72313494074136":"path---news-press-kit-f49a29d3bc2fabeb8190.js","141666846945901":"path---support-bf3737a42974bcc2fcc5.js","235145966638131":"path---postgraphile-code-of-conduct-17a0e9e62d6a317b6c11.js","114781403929568":"path---postgraphile-community-chat-612b76bb42bb938146fe.js","216163489569211":"path---postgraphile-community-plugins-dfd2da18474ee7632105.js","99411096849217":"path---postgraphile-computed-columns-88979f1775d126d13873.js","245194823331250":"path---postgraphile-connections-06cf2175246e662f83c3.js","226259727392765":"path---postgraphile-crud-mutations-055619ef23c9722b9af9.js","209456356109321":"path---postgraphile-custom-mutations-1ac5a01e428fcf7f89b1.js","262226386268176":"path---postgraphile-custom-queries-56303b546128a2f8bcb5.js","58450730530065":"path---postgraphile-debugging-c7b226bf00934197684c.js","183024611244872":"path---postgraphile-default-role-747b99404bb515473657.js","46110498460401":"path---postgraphile-evaluating-b833e7b694231c31afa7.js","235675790195762":"path---postgraphile-examples-6652898193179d6c08f4.js","1465359564156":"path---postgraphile-extending-288bfa94c5f2da1ff519.js","29661158995595":"path---postgraphile-filtering-d067303d06102b8a4420.js","101562502586227":"path---postgraphile-function-gallery-1e4db829282840a95d3f.js","101463202308976":"path---postgraphile-function-restrictions-db62c1aec51ae9e49a11.js","34445096275681":"path---postgraphile-inflection-4ced8881e12b380c9096.js","231292683096477":"path---postgraphile-introduction-19af939257f5455d4517.js","33982096820675":"path---postgraphile-introspection-ee29c3c3e12c2f3d09f7.js","131593726388413":"path---postgraphile-jwk-verification-7cb4208bdac1eeb8f953.js","217512476184238":"path---postgraphile-jwt-guide-4e8a3485cd73858a71bc.js","64254551156649":"path---postgraphile-make-add-inflectors-plugin-3964946bcbf80b153868.js","49645441935291":"path---postgraphile-namespaces-36edfe9a12efa43b2ddb.js","206205697905610":"path---postgraphile-node-id-736601e0dc4f9566df3c.js","245838197689590":"path---postgraphile-performance-a1534c2709468cd3265d.js","193154730806080":"path---postgraphile-plugin-gallery-80e166ce7ea30cd66aec.js","34112019379484":"path---postgraphile-plugins-c2ab102efa7683f57669.js","43306645800525":"path---postgraphile-postgresql-indexes-63946fec661d0ec5e88e.js","257659440118484":"path---postgraphile-procedures-0806b42c6cb7a8bb6dfc.js","20524195157075":"path---postgraphile-quick-start-guide-c8ad6e740b99fcb3e14a.js","136696082986067":"path---postgraphile-relations-e3c7df999beaeadd66c5.js","187294999324209":"path---postgraphile-requirements-b8804747dccf00f08088.js","126695865748518":"path---postgraphile-reserved-keywords-dedae42c2922419ddf2a.js","143935096069691":"path---postgraphile-security-dfe172309c872e4109f4.js","244450434420656":"path---postgraphile-tables-9ee274dad0154493ffd8.js","247601703930759":"path---postgraphile-usage-1a8a69c15b2ef46c4121.js","270428963090724":"path---postgraphile-versioning-policy-0e273639302f45c755e6.js","156260474427399":"path---postgraphile-why-nullable-583703540927ddbc7318.js","76338124382236":"path---graphile-build-look-ahead-c5e39a7de66311b83e31.js","187503077063819":"path---postgraphile-extending-raw-b02692e74f9d057a77d8.js","202678300341359":"path---postgraphile-functions-78d43fc28fd32b3c49ae.js","30601655320255":"path---postgraphile-make-extend-schema-plugin-3b61e6166bae4bbb3586.js","85182451526728":"path---postgraphile-pricing-56f8cb3229fe40a70b8b.js","163587040327238":"path---postgraphile-production-1d5fd94a0de53d9b75fa.js","27297302318019":"path---postgraphile-smart-comments-7cfeb28816e65cd78a52.js","112985368742066":"path---postgraphile-subscriptions-e27899eb583883c906c1.js","174583816914262":"path---postgraphile-testing-jest-31a3f0d40a5b51997c5c.js","3265662318058":"path---postgraphile-usage-cli-ecd4c9ebe64c792d3981.js","148070795768796":"path---postgraphile-usage-library-3c127ffc80a4ebfe4047.js","272066437984048":"path---postgraphile-usage-schema-836ed63c46428d9ff943.js","87638492893048":"path---postgraphile-v-3-migration-39c2dd66a33fd7dba90b.js","57656932303775":"path---postgraphile-v-4-new-features-171417b66cbbbe3941f7.js","142629428675168":"path---index-9af5238ba8a8966def21.js","48764759135427":"path---postgraphile-41f8bb3e02937bae057e.js","17839233601159":"path---postgraphile-postgresql-schema-design-efd46bc4cdbdefa41e88.js","114276838955818":"component---src-layouts-index-js-ace7914a8fea060c15f6.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-e9c5ebe9f9d03df65cb6.js","/app-1b68f72edc9b9cfdf508.js","/path---postgraphile-make-extend-schema-plugin-3b61e6166bae4bbb3586.js","/component---src-templates-page-js-6df43615680729d980c3.js","/component---src-layouts-index-js-ace7914a8fea060c15f6.js"])/*]]>*/</script><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script></body></html>